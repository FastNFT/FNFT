/*
 * This file is part of FNFT.
 *
 * FNFT is free software; you can redistribute it and/or
 * modify it under the terms of the version 2 of the GNU General
 * Public License as published by the Free Software Foundation.
 *
 * FNFT is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 *
 * Contributors:
 * Sander Wahls (TU Delft) 2017-2018.
 */
#define FNFT_ENABLE_SHORT_NAMES

#include "fnft__poly_roots_fasteigen.h"
#include "fnft__misc.h"
#include "fnft__errwarn.h"
#ifdef DEBUG
#include <stdio.h>
#endif

// Test case is a random polynomial of degree 172

INT poly_roots_fasteigen_test_c_port_random()
{
    const UINT deg = 172;
    COMPLEX p[173] = {
  -0.37 - 1.19*I,
  0.24 - 0.79*I,
  0.74 - 0.87*I,
  -0.62 - 1.9*I,
  0.45 - 0.07000000000000001*I,
  0.71 - 2.48*I,
  -0.55 - 0.54*I,
  -0.02 + 0.17*I,
  0.38 - 1.11*I,
  0.47 + 0.87*I,
  0.44 - 0.97*I,
  -1.33 - 0.44*I,
  0.38 - 0.98*I,
  1.09 - 0.38*I,
  -0.71 - 0.86*I,
  -1.22 + 0.03*I,
  1.39 + 1.52*I,
  0.68 + 1.45*I,
  -0.29 - 0.21*I,
  0.66 + 0.09*I,
  1.05 - 1.82*I,
  -1.12 + 0.86*I,
  1.6 - 0.77*I,
  1.29 + 0.97*I,
  -0.78 + 1.12*I,
  -0.2 + 0.52*I,
  0.97 - 0.5700000000000001*I,
  -0.13 - 0.9500000000000001*I,
  -2.28 - 0.29*I,
  -0.41 + 1.95*I,
  1.35 + 0.21*I,
  0.6900000000000001 + 0.32*I,
  -0.75 - 1.39*I,
  -1.44 + 0.42*I,
  1.2 - 0.7000000000000001*I,
  -0.58 - 0.5*I,
  2 - 0.35*I,
  -1.22 - 0.86*I,
  -0.32 + 1.66*I,
  -2.13 - 1.81*I,
  -1.78 + 0.01*I,
  -0.47 + 0.06*I,
  -0.9 - 1.02*I,
  1.74 + 0.38*I,
  -0.2 + 2.77*I,
  1.28 + 0.49*I,
  -0.03 + 1.08*I,
  0.43 + 0.64*I,
  0.46 + 1.18*I,
  0.37 + 0.52*I,
  1.06 - 1.02*I,
  -0.35 + 2.32*I,
  1.25 + 1.86*I,
  0 + 1.76*I,
  0.63 - 0.55*I,
  0.79 + 0.66*I,
  0.53 + 0.14*I,
  1.31 - 0.77*I,
  0.02 + 0.49*I,
  -1.44 - 0.33*I,
  1.09 + 0.34*I,
  -0.4 + 1*I,
  -0.06 + 0.14*I,
  -1.14 - 0.66*I,
  -1.72 + 1.03*I,
  -1.4 - 1.54*I,
  -0.44 + 0.5600000000000001*I,
  -0.1 + 0.47*I,
  0.06 + 1.07*I,
  0.19 - 0.03*I,
  1.32 + 1.16*I,
  1.69 - 0.13*I,
  0.74 + 0.97*I,
  -1.46 - 0.49*I,
  -1.01 + 1.02*I,
  0.46 - 1.05*I,
  0.36 + 0.51*I,
  -0.49 + 0.77*I,
  -0.92 - 0.17*I,
  -1.04 + 1.62*I,
  -0.15 + 0.73*I,
  -0.59 - 2.12*I,
  -0.26 - 0.3*I,
  -0.36 - 0.34*I,
  0.28 + 0.91*I,
  -1.19 + 0.12*I,
  -0.36 + 0.32*I,
  -0.93 - 2.22*I,
  -0.5 + 1.85*I,
  -0.77 + 0.7000000000000001*I,
  -1.07 - 1.55*I,
  -1 - 0.46*I,
  1.02 - 0.03*I,
  0.19 - 1.3*I,
  -2.19 + 1.14*I,
  -0.8300000000000001 - 0.74*I,
  0.65 - 0.39*I,
  0.85 + 0.88*I,
  1.52 - 0.23*I,
  0.54 + 1.23*I,
  1.57 + 1.87*I,
  -0.49 - 1.29*I,
  0.66 - 0.36*I,
  -1.54 - 0.66*I,
  -0.12 - 0.66*I,
  -1.52 + 1.08*I,
  -1.22 + 0.9400000000000001*I,
  1.2 - 0.67*I,
  -0.26 - 0.17*I,
  0.64 - 1.64*I,
  0.32 + 0.22*I,
  0.71 - 0.31*I,
  2.48 + 1.12*I,
  -1.42 - 0.76*I,
  -0.23 + 1.46*I,
  0.06 - 0.65*I,
  0.89 - 0.9*I,
  -1.28 + 1.49*I,
  -0.85 + 1.26*I,
  -1.23 - 0.34*I,
  0.07000000000000001 + 0.61*I,
  0.66 + 0.93*I,
  0.6 + 0.29*I,
  -0.66 - 0.63*I,
  0.25 + 1.1*I,
  0.22 + 0.7000000000000001*I,
  0.37 + 1.09*I,
  0.8300000000000001 - 0.54*I,
  -0.8300000000000001 - 0.08*I,
  -0.98 + 0.16*I,
  0.3 + 0.17*I,
  -0.39 + 1.13*I,
  -0.33 + 0.64*I,
  -1.9 - 0.59*I,
  0.91 + 0.41*I,
  -1.19 + 1.62*I,
  2.68 - 0.28*I,
  0.03 + 1.2*I,
  1 - 0.16*I,
  -0.5600000000000001 + 0.5*I,
  1.01 - 0.2*I,
  0.22 + 0.23*I,
  -1.28 - 0.86*I,
  -0.52 - 0.53*I,
  0.8300000000000001 - 1.85*I,
  -1.37 + 0.24*I,
  1.23 + 1.23*I,
  -0.24 - 0.6*I,
  0.62 - 1.83*I,
  -1.25 + 1.3*I,
  1.12 - 0.61*I,
  1.35 + 0.89*I,
  -0.16 - 0.7000000000000001*I,
  -1.83 - 0.58*I,
  -0.7000000000000001 + 0.58*I,
  -0.77 + 0.6900000000000001*I,
  -0.33 - 0.49*I,
  1.19 + 2.64*I,
  -1.7 + 1.16*I,
  0.23 - 0.35*I,
  -2.29 + 1.05*I,
  -1.48 - 0.28*I,
  -1.87 - 0.25*I,
  0.9 + 0.55*I,
  -0.5600000000000001 - 0.03*I,
  1.6 + 1.07*I,
  0.33 + 0.13*I,
  -0.17 - 0.42*I,
  -0.33 + 0.52*I,
  -0.04 - 0.21*I,
  0.29 + 0.49*I,
  -1.16 + 0.67*I,
  -0.16 - 1.25*I
    };
    COMPLEX roots_external[172] = {
  -1.326048517635261 + 0.06640666290946351*I,
  0.05378821519777444 - 1.326658117010365*I,
  0.7699076748229718 - 0.9460795449584909*I,
  -1.157047805919882 - 0.1138190187530134*I,
  -0.3994561794988966 + 1.049134431728185*I,
  -0.3763236298239258 - 1.018097482444908*I,
  -0.6013802062233001 + 0.8736744884701685*I,
  -1.020945266900562 - 0.2616651015470863*I,
  -0.9421857224341815 - 0.436930645984788*I,
  -0.6927409768501519 - 0.7379779186006341*I,
  -0.6593886730346884 - 0.7624646816564563*I,
  -0.701536158392051 - 0.7029203717619664*I,
  -0.7871868983230664 - 0.6338198579999067*I,
  -0.7254220934778878 - 0.6634398922151938*I,
  -0.7487470098665288 - 0.6396054083908937*I,
  -0.8283210521185624 - 0.5611512577736498*I,
  -0.7863028947128498 - 0.5800313633992082*I,
  -0.5871111101206631 - 0.8202917171602647*I,
  -0.8507380874765991 - 0.5095878657841844*I,
  -0.9088750488813846 - 0.3952110535138676*I,
  -0.9407770119658699 - 0.3378327690248134*I,
  -0.8808326281864609 - 0.4425192720010361*I,
  -0.9438981658651063 - 0.2928794370247436*I,
  -0.6748737948025667 + 0.7767439650203608*I,
  -0.7999128012474921 + 0.6495047405145327*I,
  -0.7214838398266685 + 0.7172776985510638*I,
  -0.7454849901403505 + 0.6941954940679348*I,
  -0.9602522402960637 - 0.2409686929449745*I,
  -0.685400380432469 + 0.731710831985616*I,
  -0.9625024392749789 + 0.3586467407373034*I,
  -0.6235627948800274 - 0.7764107715518708*I,
  -0.8581059915018959 - 0.4514515856155529*I,
  -0.9798016846318675 - 0.1910393929700386*I,
  -0.8920948482130849 + 0.4961740249971052*I,
  -0.9602887902049976 + 0.3392641325627918*I,
  -0.9785483283944424 + 0.257793120237515*I,
  -0.9813805446826099 + 0.2174899342348899*I,
  -1.002700643506728 + 0.1260785949286256*I,
  -0.9882684132439522 + 0.171214771602638*I,
  -0.8523093610707354 + 0.5277419731298224*I,
  -0.9137210461674394 + 0.4085033049002103*I,
  -0.9550269647903791 + 0.2812260309145039*I,
  -0.5287344988817257 - 0.8610683433623078*I,
  -0.994146033547568 - 0.1331244632619304*I,
  -1.018996180840874 + 0.02272407440082626*I,
  -1.003311193910217 + 0.08003711699328031*I,
  -0.763692356966061 + 0.6359040646651112*I,
  -0.8051195132075404 + 0.5812003994524046*I,
  -0.8668065697952992 + 0.4562691028765632*I,
  -0.5300150869725588 - 0.8086780756279316*I,
  -0.8801306541124554 + 0.4076361613034679*I,
  -0.7945103867365175 + 0.5591699007801482*I,
  -0.4534754236515225 - 0.8807279541854343*I,
  -0.4297824237099718 - 0.9042271525723113*I,
  -0.993682863216414 - 0.09285476463901998*I,
  -0.4765869988447454 - 0.848610233031346*I,
  -0.3635688342968601 - 0.9307405413637748*I,
  -0.762340895430884 - 0.4355346374814493*I,
  -0.618914840900353 + 0.7804064793605207*I,
  -0.5839486193204544 + 0.824482559448423*I,
  -0.3217857059476627 - 0.9139958082947116*I,
  -0.2713307439886616 - 0.9550871347768397*I,
  -0.2913146174275833 - 0.9352639535512433*I,
  -0.2282054277922247 - 0.9726279938183603*I,
  -0.1817326988674442 - 0.9883616835590329*I,
  0.5138907854940246 - 0.9911680944946824*I,
  0.7485478595162264 + 0.8400457965807074*I,
  -0.06285161732353907 - 1.043980065301408*I,
  -0.5146132257175772 + 0.8431306244020434*I,
  -0.4845278240419476 + 0.8914289362921214*I,
  -0.1169401026390153 - 0.9878968597561036*I,
  0.7477927855650151 + 0.6944383937924142*I,
  0.9385030017830083 - 0.4736227868308681*I,
  0.805375203289399 - 0.6201963911830033*I,
  0.712547326025847 - 0.7148762130031761*I,
  0.7335894996221958 - 0.6825558368280106*I,
  0.6398749497427266 - 0.7727088680124841*I,
  0.6780829663148298 - 0.7238665891029222*I,
  0.6030689906827087 - 0.791353537118082*I,
  0.5778069042554391 - 0.8156094556068264*I,
  0.7548039238575986 - 0.6376441861673074*I,
  -0.44830392813757 + 0.8893935935472651*I,
  0.8319853723401384 - 0.5727699373767071*I,
  0.5286029767477753 - 0.8472000618767198*I,
  0.3140560112597801 - 0.9966692636740073*I,
  0.8044813766533498 + 0.6003197081457429*I,
  0.7722169137115593 + 0.6353479534810873*I,
  0.7301293029577145 + 0.6775461528143991*I,
  0.875350175646383 + 0.524249664189791*I,
  0.5283147425517317 + 0.8729878834238086*I,
  0.6525075042226622 + 0.7531695624347028*I,
  0.6828373415713256 + 0.7109726756034876*I,
  0.5704931597149412 + 0.82749748695222*I,
  0.6149686247381719 + 0.7764140914812331*I,
  0.4821729560985659 - 0.8641498545134975*I,
  0.8242353053110476 + 0.5666740167310361*I,
  -0.07650617741270813 - 0.9935672933860896*I,
  0.4540843319962757 - 0.8882561170427576*I,
  0.8625713824723343 + 0.5198976006917404*I,
  0.8204725526136274 - 0.5532861229357928*I,
  0.4373105755875877 + 0.9440276034063857*I,
  0.4852939004943104 + 0.8941981846924858*I,
  0.5252630051441017 + 0.8474909843466185*I,
  -0.4057206428672028 + 0.9131891190229622*I,
  -0.3768019306894393 + 0.9421661219249968*I,
  0.3636432800830092 - 0.9369856473940299*I,
  0.3942797373830841 - 0.91419940933*I,
  -0.4874879318752166 + 0.7765475579464529*I,
  0.865297787574031 - 0.4944220910876673*I,
  0.8584117826617308 + 0.4821320884874601*I,
  0.9158647811898504 + 0.4358750646371217*I,
  0.3698846700952532 + 0.9621445712383859*I,
  0.9169953171622599 - 0.4252392941138959*I,
  -0.002080967859798295 - 1.001469434847161*I,
  0.2775219304205289 - 0.9710786381788832*I,
  0.8200782340025865 - 0.4875165409744517*I,
  0.4187227125068894 + 0.8927740113686267*I,
  0.9164900983832945 - 0.3884752384346885*I,
  0.9107213302980146 + 0.396476155969671*I,
  0.9363435451695477 + 0.3699458300705115*I,
  -0.3276633835956649 + 0.9470866877367051*I,
  0.2309714591419141 - 0.9777372812302269*I,
  0.1861309062916008 + 1.038517237983919*I,
  0.03945831480693159 - 0.9984131315206825*I,
  0.9549200587809783 + 0.3270691254542763*I,
  0.9764164097640586 - 0.2969676838487024*I,
  0.9179439021061058 - 0.3453475080236089*I,
  0.9446732392513381 - 0.3071495647821004*I,
  0.3509923911195981 - 0.8669858638391513*I,
  0.9855822903706175 + 0.2647153556707607*I,
  0.5514005872021418 + 0.6898858492407235*I,
  0.21524050114223 + 1.015115905225263*I,
  0.2674513288769642 + 0.9742807631648365*I,
  0.3454343770131166 + 0.9048096149351311*I,
  0.3153520089509695 + 0.9328236802222517*I,
  0.1903499527915344 - 0.9630220116252119*I,
  -0.2745748690170435 + 0.9522598738397798*I,
  0.9515534926472005 + 0.2727500833372754*I,
  0.9599313374741564 - 0.238866678934916*I,
  0.9817494518773002 - 0.1923184889394032*I,
  1.005027350425181 - 0.1480590452371683*I,
  0.09289406672735553 - 0.9882985213618404*I,
  -0.2472384073107905 + 0.9446855843192737*I,
  0.9710006054532525 + 0.2065494291773326*I,
  0.009172743295295542 + 1.031972768476604*I,
  -0.2042870940957613 + 0.9766276537058058*I,
  0.1936504394703541 + 0.9593333181673556*I,
  0.1410581218786833 + 0.985333283554867*I,
  0.9926257997657094 - 0.121338499209963*I,
  0.09000370061099006 + 1.004762022225762*I,
  -0.1583510901123294 + 0.9865873566981475*I,
  0.9846413392221174 + 0.163227148053275*I,
  0.1271300354506578 - 0.9779252599520671*I,
  1.01341015060282 + 0.0007122173969183085*I,
  0.9998208569009949 + 0.1039814548649494*I,
  0.07058020820915094 + 0.9865425894826907*I,
  -0.9788802781111169 - 0.05855673192388816*I,
  -0.9755193872195899 - 0.01990787445647897*I,
  -0.1166127577127161 + 0.9851699554851271*I,
  0.9935018274504088 - 0.0379738398823293*I,
  0.98828133511675 - 0.06915068466602595*I,
  -0.02730546365784083 + 0.9889523306556716*I,
  0.992346937434283 + 0.04193710232997667*I,
  0.9811533649666717 + 0.1080156210894592*I,
  -0.08679196383536106 + 0.9780619581288396*I,
  -0.04643592252739161 + 0.9815677449603036*I,
  0.8577778326634398 + 0.2659703855099533*I,
  0.1023654164805199 - 0.9072486507390733*I,
  -0.8467513675269261 + 0.08811544244171332*I,
  0.8086480237624332 - 0.1312166439984796*I,
  -0.08300699515676171 - 0.7942377263292953*I,
  0.5443811191556417 - 0.5153887796590548*I
    };
    COMPLEX roots_fortran[172];
    COMPLEX roots_c_port[172];
    INT ret_code;

    ret_code = poly_roots_fasteigen_(deg, p, roots_fortran);
    if (ret_code != SUCCESS)
        return E_SUBROUTINE(ret_code);

    ret_code = poly_roots_fasteigen(deg, p, roots_c_port);
    if (ret_code != SUCCESS)
        return E_SUBROUTINE(ret_code);

    // check that C port gives same result as Fortran version
    for (UINT i=0; i<deg; i++) {
        const REAL diff = CABS(roots_fortran[i] - roots_c_port[i]);
        const REAL tol = 100*EPSILON*CABS(roots_fortran[i]);
        if (diff > tol) {
#ifdef DEBUG
            printf("diff = %g > tol = %g\n", diff, tol);
#endif
            return E_TEST_FAILED;
        }
    }

    // check that roots are close to results from Octave
    const REAL dist = misc_hausdorff_dist(deg, roots_c_port, deg, roots_external);
    if (!(dist <= 100*EPSILON))
        return E_TEST_FAILED;

    return SUCCESS;
}

INT main()
{
    if ( poly_roots_fasteigen_test_c_port_random() != SUCCESS )
        return EXIT_FAILURE;

    return EXIT_SUCCESS;
}
