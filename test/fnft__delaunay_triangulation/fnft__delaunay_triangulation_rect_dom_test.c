/*
* This file is part of FNFT.  
*                                                                  
* FNFT is free software; you can redistribute it and/or
* modify it under the terms of the version 2 of the GNU General
* Public License as published by the Free Software Foundation.
*
* FNFT is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU General Public License for more details.
*                                                                      
* You should have received a copy of the GNU General Public License
* along with this program. If not, see <http://www.gnu.org/licenses/>.
*
* Contributors:
* Shrinivas Chimmalgi (TU Delft) 2020.
*/

#define FNFT_ENABLE_SHORT_NAMES

#include <stdio.h>

#include "fnft__delaunay_triangulation.h"

static INT delaunay_triangulation_rect_dom_test()
{
    INT ret_code = SUCCESS;
    UINT i;   
    REAL *NewNodesCoordX = NULL;
    REAL *NewNodesCoordY = NULL;
    UINT NrOfNewNodesCoord = 0;
    REAL NewNodesCoordX_exact[84] = {
      -5.000000000000000e+00,
	  -5.000000000000000e+00,
	  -5.000000000000000e+00,
	  -5.000000000000000e+00,
	  -5.000000000000000e+00,
	  -5.000000000000000e+00,
	  -4.166666666666667e+00,
	  -4.166666666666667e+00,
	  -4.166666666666667e+00,
	  -4.166666666666667e+00,
	  -4.166666666666667e+00,
	  -4.166666666666667e+00,
	  -3.333333333333333e+00,
	  -3.333333333333333e+00,
	  -3.333333333333333e+00,
	  -3.333333333333333e+00,
	  -3.333333333333333e+00,
	  -3.333333333333333e+00,
	  -2.500000000000000e+00,
	  -2.500000000000000e+00,
	  -2.500000000000000e+00,
	  -2.500000000000000e+00,
	  -2.500000000000000e+00,
	  -2.500000000000000e+00,
	  -1.666666666666667e+00,
	  -1.666666666666667e+00,
	  -1.666666666666667e+00,
	  -1.666666666666667e+00,
	  -1.666666666666667e+00,
	  -1.666666666666667e+00,
	  -8.333333333333330e-01,
	  -8.333333333333330e-01,
	  -8.333333333333330e-01,
	  -8.333333333333330e-01,
	  -8.333333333333330e-01,
	  -8.333333333333330e-01,
	  0.000000000000000e+00,
	  0.000000000000000e+00,
	  0.000000000000000e+00,
	  0.000000000000000e+00,
	  0.000000000000000e+00,
	  0.000000000000000e+00,
	  8.333333333333339e-01,
	  8.333333333333339e-01,
	  8.333333333333339e-01,
	  8.333333333333339e-01,
	  8.333333333333339e-01,
	  8.333333333333339e-01,
	  1.666666666666667e+00,
	  1.666666666666667e+00,
	  1.666666666666667e+00,
	  1.666666666666667e+00,
	  1.666666666666667e+00,
	  1.666666666666667e+00,
	  2.500000000000000e+00,
	  2.500000000000000e+00,
	  2.500000000000000e+00,
	  2.500000000000000e+00,
	  2.500000000000000e+00,
	  2.500000000000000e+00,
	  3.333333333333334e+00,
	  3.333333333333334e+00,
	  3.333333333333334e+00,
	  3.333333333333334e+00,
	  3.333333333333334e+00,
	  3.333333333333334e+00,
	  4.166666666666668e+00,
	  4.166666666666668e+00,
	  4.166666666666668e+00,
	  4.166666666666668e+00,
	  4.166666666666668e+00,
	  4.166666666666668e+00,
	  5.000000000000000e+00,
	  5.000000000000000e+00,
	  5.000000000000000e+00,
	  5.000000000000000e+00,
	  5.000000000000000e+00,
	  5.000000000000000e+00,
	  -4.166666666666667e+00,
	  -2.500000000000000e+00,
	  -8.333333333333330e-01,
	  8.333333333333339e-01,
	  2.500000000000000e+00,
	  4.166666666666668e+00
    };
    
    REAL NewNodesCoordY_exact[84] = {
      0.000000000000000e+00,
	  1.000000000000000e+00,
	  2.000000000000000e+00,
	  3.000000000000000e+00,
	  4.000000000000000e+00,
	  5.000000000000000e+00,
	  5.000000000000000e-01,
	  1.500000000000000e+00,
	  2.500000000000000e+00,
	  3.500000000000000e+00,
	  4.500000000000000e+00,
	  5.000000000000000e+00,
	  0.000000000000000e+00,
	  1.000000000000000e+00,
	  2.000000000000000e+00,
	  3.000000000000000e+00,
	  4.000000000000000e+00,
	  5.000000000000000e+00,
	  5.000000000000000e-01,
	  1.500000000000000e+00,
	  2.500000000000000e+00,
	  3.500000000000000e+00,
	  4.500000000000000e+00,
	  5.000000000000000e+00,
	  0.000000000000000e+00,
	  1.000000000000000e+00,
	  2.000000000000000e+00,
	  3.000000000000000e+00,
	  4.000000000000000e+00,
	  5.000000000000000e+00,
	  5.000000000000000e-01,
	  1.500000000000000e+00,
	  2.500000000000000e+00,
	  3.500000000000000e+00,
	  4.500000000000000e+00,
	  5.000000000000000e+00,
	  0.000000000000000e+00,
	  1.000000000000000e+00,
	  2.000000000000000e+00,
	  3.000000000000000e+00,
	  4.000000000000000e+00,
	  5.000000000000000e+00,
	  5.000000000000000e-01,
	  1.500000000000000e+00,
	  2.500000000000000e+00,
	  3.500000000000000e+00,
	  4.500000000000000e+00,
	  5.000000000000000e+00,
	  0.000000000000000e+00,
	  1.000000000000000e+00,
	  2.000000000000000e+00,
	  3.000000000000000e+00,
	  4.000000000000000e+00,
	  5.000000000000000e+00,
	  5.000000000000000e-01,
	  1.500000000000000e+00,
	  2.500000000000000e+00,
	  3.500000000000000e+00,
	  4.500000000000000e+00,
	  5.000000000000000e+00,
	  0.000000000000000e+00,
	  1.000000000000000e+00,
	  2.000000000000000e+00,
	  3.000000000000000e+00,
	  4.000000000000000e+00,
	  5.000000000000000e+00,
	  5.000000000000000e-01,
	  1.500000000000000e+00,
	  2.500000000000000e+00,
	  3.500000000000000e+00,
	  4.500000000000000e+00,
	  5.000000000000000e+00,
	  0.000000000000000e+00,
	  1.000000000000000e+00,
	  2.000000000000000e+00,
	  3.000000000000000e+00,
	  4.000000000000000e+00,
	  5.000000000000000e+00,
	  0.000000000000000e+00,
	  0.000000000000000e+00,
	  0.000000000000000e+00,
	  0.000000000000000e+00,
	  0.000000000000000e+00,
	  0.000000000000000e+00
    };
    
    ret_code = delaunay_triangulation_rect_dom(-5, 5, 0, 5, 1, &NrOfNewNodesCoord, &NewNodesCoordX, &NewNodesCoordY);
    CHECK_RETCODE(ret_code, leave_fun);
    
    if (ret_code != SUCCESS)
        goto leave_fun;    
    
    if (NrOfNewNodesCoord != 84)
            return E_TEST_FAILED;    
   
    REAL errX = 0;
    for (i=0; i<84; i++)
        errX += FABS(NewNodesCoordX_exact[i]-NewNodesCoordX[i]);
    
    REAL errY = 0;
    for (i=0; i<84; i++)
        errY += FABS(NewNodesCoordY_exact[i]-NewNodesCoordY[i]);
    
#ifdef DEBUG
    printf("errX=%g\n",errX);
    printf("errY=%g\n",errY);
#endif
    if ((errX > 1e-13) || (errY > 1e-13))
        return E_TEST_FAILED;
    
    leave_fun:
        free(NewNodesCoordX);
        free(NewNodesCoordY);
        return ret_code;
}

INT main()
{
    if ( delaunay_triangulation_rect_dom_test() != SUCCESS )
        return EXIT_FAILURE;

    return EXIT_SUCCESS;
}
