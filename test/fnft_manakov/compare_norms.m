% For D = 512
M = 16;

ab_num = [-1.008307632120e+000+-2.320287961728e-002j, -8.295547117234e-001+-5.695009694967e-001j, -3.057248128210e-001+-9.562868366336e-001j, 4.370461898592e-001+-9.003387247095e-001j, 9.668836201898e-001+-2.221652116393e-001j, 6.407625119231e-001+7.111497469521e-001j, -3.921964106171e-001+7.358488561872e-001j, -6.818433384500e-001+1.564330887049e-014j, -3.921964106171e-001+-7.358488561872e-001j, 6.407625119230e-001+-7.111497469521e-001j, 9.668836201898e-001+2.221652116393e-001j, 4.370461898593e-001+9.003387247096e-001j, -3.057248128210e-001+9.562868366337e-001j, -8.295547117234e-001+5.695009694967e-001j, -1.008307632120e+000+2.320287961724e-002j, -8.927919114053e-001+-4.748520531005e-001j, 9.177948033504e-004+-2.100996568103e-007j, 2.009062341099e-003+-3.046588030367e-007j, 4.397947186278e-003+-4.168587920277e-007j, 9.618750226399e-003+-5.297117435037e-007j, 2.092570812665e-002+-6.100967335802e-007j, 4.435621749399e-002+-6.049399481401e-007j, 8.398448849231e-002+-4.263628991252e-007j, 1.112295612776e-001+1.273292582482e-015j, 8.398448849231e-002+4.263629058308e-007j, 4.435621749398e-002+6.049399436784e-007j, 2.092570812660e-002+6.100967073265e-007j, 9.618750226350e-003+5.297117596228e-007j, 4.397947186238e-003+4.168588541305e-007j, 2.009062341012e-003+3.046588036134e-007j, 9.177948032947e-004+2.100996771693e-007j, 4.193567051815e-004+1.383052952524e-007j, 5.965666221775e-003+-1.365647769602e-006j, 1.305890521714e-002+-1.980282217851e-006j, 2.858665671081e-002+-2.709582148808e-006j, 6.252187647159e-002+-3.443126332180e-006j, 1.360171028232e-001+-3.965628767075e-006j, 2.883154137109e-001+-3.932109662628e-006j, 5.458991752000e-001+-2.771358845927e-006j, 7.229921483041e-001+6.875779945403e-015j, 5.458991752000e-001+2.771358885746e-006j, 2.883154137109e-001+3.932109634171e-006j, 1.360171028229e-001+3.965628597353e-006j, 6.252187647128e-002+3.443126435373e-006j, 2.858665671055e-002+2.709582551407e-006j, 1.305890521657e-002+1.980282221736e-006j, 5.965666221413e-003+1.365647901904e-006j, 2.725818583678e-003+8.989844211933e-007j];
ab_exact = [-9.644260197536e-001+-2.642849739162e-001j, -9.384622196167e-001+3.451318071639e-001j, -4.943100550496e-001+8.688079880664e-001j, 2.810892903972e-001+9.576046680321e-001j, 9.302059085550e-001+3.403385888745e-001j, 6.972263717197e-001+-6.548940701021e-001j, -3.611240215511e-001+-7.514144455356e-001j, -6.818433382465e-001+0.000000000000e+000j, -3.611240215511e-001+7.514144455356e-001j, 6.972263717197e-001+6.548940701021e-001j, 9.302059085550e-001+-3.403385888745e-001j, 2.810892903972e-001+-9.576046680321e-001j, -4.943100550496e-001+-8.688079880664e-001j, -9.384622196167e-001+-3.451318071639e-001j, -9.644260197536e-001+2.642849739162e-001j, -6.818818551989e-001+7.314572246134e-001j, 9.111383262032e-004+0.000000000000e+000j, 1.998253780620e-003+0.000000000000e+000j, 4.381382970647e-003+0.000000000000e+000j, 9.595411460231e-003+0.000000000000e+000j, 2.089700181070e-002+0.000000000000e+000j, 4.432907513454e-002+0.000000000000e+000j, 8.397161261306e-002+0.000000000000e+000j, 1.112295613064e-001+0.000000000000e+000j, 8.397161261306e-002+0.000000000000e+000j, 4.432907513454e-002+0.000000000000e+000j, 2.089700181070e-002+0.000000000000e+000j, 9.595411460231e-003+0.000000000000e+000j, 4.381382970647e-003+0.000000000000e+000j, 1.998253780620e-003+0.000000000000e+000j, 9.111383262032e-004+0.000000000000e+000j, 4.154282228850e-004+0.000000000000e+000j, 5.922399120321e-003+0.000000000000e+000j, 1.298864957403e-002+0.000000000000e+000j, 2.847898930921e-002+0.000000000000e+000j, 6.237017449150e-002+0.000000000000e+000j, 1.358305117695e-001+0.000000000000e+000j, 2.881389883745e-001+0.000000000000e+000j, 5.458154819849e-001+0.000000000000e+000j, 7.229921484916e-001+0.000000000000e+000j, 5.458154819849e-001+0.000000000000e+000j, 2.881389883745e-001+0.000000000000e+000j, 1.358305117695e-001+0.000000000000e+000j, 6.237017449150e-002+0.000000000000e+000j, 2.847898930921e-002+0.000000000000e+000j, 1.298864957403e-002+0.000000000000e+000j, 5.922399120321e-003+0.000000000000e+000j, 2.700283448752e-003+0.000000000000e+000j];
contspec_num = [-8.769935316796e-004+-2.428329874343e-004j, -1.875362700568e-003+6.852336071705e-004j, -2.172355461653e-003+3.803973496607e-003j, 2.696100064445e-003+9.225065564141e-003j, 1.980273551578e-002+7.263397743944e-003j, 3.379036181200e-002+-3.170774178266e-002j, -4.360848889254e-002+-9.078993720824e-002j, -1.631306709404e-001+-5.610080554499e-015j, -4.360848889256e-002+9.078993720824e-002j, 3.379036181200e-002+3.170774178265e-002j, 1.980273551573e-002+-7.263397743951e-003j, 2.696100064446e-003+-9.225065564089e-003j, -2.172355461580e-003+-3.803973496603e-003j, -1.875362700487e-003+-6.852336071413e-004j, -8.769935316317e-004+2.428329874001e-004j, -2.817781191470e-004+3.042712101673e-004j, -5.700457955915e-003+-1.578414418322e-003j, -1.218985755370e-002+4.454018446608e-003j, -1.412031050075e-002+2.472582772795e-002j, 1.752465041889e-002+5.996292616692e-002j, 1.287177808526e-001+4.721208533564e-002j, 2.196373517780e-001+-2.061003215873e-001j, -2.834551778015e-001+-5.901345918536e-001j, -1.060349361112e+000+-3.441135402929e-014j, -2.834551778016e-001+5.901345918535e-001j, 2.196373517780e-001+2.061003215873e-001j, 1.287177808522e-001+-4.721208533568e-002j, 1.752465041890e-002+-5.996292616658e-002j, -1.412031050027e-002+-2.472582772792e-002j, -1.218985755316e-002+-4.454018446417e-003j, -5.700457955604e-003+1.578414418100e-003j, -1.831557774456e-003+1.977762866085e-003j];
contspec_exact = [-8.787570611436e-004+-2.408088150114e-004j, -1.875609592411e-003+6.897800621394e-004j, -2.167561273750e-003+3.809743560787e-003j, 2.707950757808e-003+9.225347158596e-003j, 1.981270952499e-002+7.248964492162e-003j, 3.377817869481e-002+-3.172732676694e-002j, -4.362974545088e-002+-9.078327397334e-002j, -1.631306710314e-001+0.000000000000e+000j, -4.362974545088e-002+9.078327397334e-002j, 3.377817869481e-002+3.172732676694e-002j, 1.981270952499e-002+-7.248964492162e-003j, 2.707950757808e-003+-9.225347158596e-003j, -2.167561273750e-003+-3.809743560787e-003j, -1.875609592411e-003+-6.897800621394e-004j, -8.787570611436e-004+2.408088150114e-004j, -2.832750817195e-004+3.038702430588e-004j, -5.711920897433e-003+-1.565257297574e-003j, -1.219146235067e-002+4.483570403906e-003j, -1.408914827938e-002+2.476333314512e-002j, 1.760167992575e-002+5.996475653088e-002j, 1.287826119124e-001+4.711826919906e-002j, 2.195581615162e-001+-2.062276239851e-001j, -2.835933454307e-001+-5.900912808267e-001j, -1.060349361704e+000+0.000000000000e+000j, -2.835933454307e-001+5.900912808267e-001j, 2.195581615162e-001+2.062276239851e-001j, 1.287826119124e-001+-4.711826919906e-002j, 1.760167992575e-002+-5.996475653088e-002j, -1.408914827938e-002+-2.476333314512e-002j, -1.219146235067e-002+-4.483570403906e-003j, -5.711920897433e-003+1.565257297574e-003j, -1.841288031177e-003+1.975156579882e-003j];

ab_num = [-9.940888563807e-001+-1.703232228239e-001j, -7.515941350615e-001+-6.690281235802e-001j, -2.040395314260e-001+-9.830157906711e-001j, 5.108877363133e-001+-8.605887009290e-001j, 9.789306060772e-001+-1.609850450795e-001j, 6.104052029296e-001+7.373710378855e-001j, -4.075284433599e-001+7.274696773788e-001j, -6.818433384500e-001+1.564330887049e-014j, -4.075284433599e-001+-7.274696773787e-001j, 6.104052029296e-001+-7.373710378855e-001j, 9.789306060773e-001+1.609850450795e-001j, 5.108877363133e-001+8.605887009291e-001j, -2.040395314260e-001+9.830157906711e-001j, -7.515941350615e-001+6.690281235803e-001j, -9.940888563807e-001+1.703232228239e-001j, -9.595064247569e-001+-3.192323452515e-001j, 9.177948033504e-004+-2.100996568103e-007j, 2.009062341099e-003+-3.046588030367e-007j, 4.397947186278e-003+-4.168587920277e-007j, 9.618750226399e-003+-5.297117435037e-007j, 2.092570812665e-002+-6.100967335802e-007j, 4.435621749399e-002+-6.049399481401e-007j, 8.398448849231e-002+-4.263628991252e-007j, 1.112295612776e-001+1.273292582482e-015j, 8.398448849231e-002+4.263629058308e-007j, 4.435621749398e-002+6.049399436784e-007j, 2.092570812660e-002+6.100967073265e-007j, 9.618750226350e-003+5.297117596228e-007j, 4.397947186238e-003+4.168588541305e-007j, 2.009062341012e-003+3.046588036134e-007j, 9.177948032947e-004+2.100996771693e-007j, 4.193567051815e-004+1.383052952524e-007j, 5.965666221775e-003+-1.365647769602e-006j, 1.305890521714e-002+-1.980282217851e-006j, 2.858665671081e-002+-2.709582148808e-006j, 6.252187647159e-002+-3.443126332180e-006j, 1.360171028232e-001+-3.965628767075e-006j, 2.883154137109e-001+-3.932109662628e-006j, 5.458991752000e-001+-2.771358845927e-006j, 7.229921483041e-001+6.875779945403e-015j, 5.458991752000e-001+2.771358885746e-006j, 2.883154137109e-001+3.932109634171e-006j, 1.360171028229e-001+3.965628597353e-006j, 6.252187647128e-002+3.443126435373e-006j, 2.858665671055e-002+2.709582551407e-006j, 1.305890521657e-002+1.980282221736e-006j, 5.965666221413e-003+1.365647901904e-006j, 2.725818583678e-003+8.989844211933e-007j];
ab_exact = [-9.644260197536e-001+-2.642849739162e-001j, -9.384622196167e-001+3.451318071639e-001j, -4.943100550496e-001+8.688079880664e-001j, 2.810892903972e-001+9.576046680321e-001j, 9.302059085550e-001+3.403385888745e-001j, 6.972263717197e-001+-6.548940701021e-001j, -3.611240215511e-001+-7.514144455356e-001j, -6.818433382465e-001+0.000000000000e+000j, -3.611240215511e-001+7.514144455356e-001j, 6.972263717197e-001+6.548940701021e-001j, 9.302059085550e-001+-3.403385888745e-001j, 2.810892903972e-001+-9.576046680321e-001j, -4.943100550496e-001+-8.688079880664e-001j, -9.384622196167e-001+-3.451318071639e-001j, -9.644260197536e-001+2.642849739162e-001j, -6.818818551989e-001+7.314572246134e-001j, 9.111383262032e-004+0.000000000000e+000j, 1.998253780620e-003+0.000000000000e+000j, 4.381382970647e-003+0.000000000000e+000j, 9.595411460231e-003+0.000000000000e+000j, 2.089700181070e-002+0.000000000000e+000j, 4.432907513454e-002+0.000000000000e+000j, 8.397161261306e-002+0.000000000000e+000j, 1.112295613064e-001+0.000000000000e+000j, 8.397161261306e-002+0.000000000000e+000j, 4.432907513454e-002+0.000000000000e+000j, 2.089700181070e-002+0.000000000000e+000j, 9.595411460231e-003+0.000000000000e+000j, 4.381382970647e-003+0.000000000000e+000j, 1.998253780620e-003+0.000000000000e+000j, 9.111383262032e-004+0.000000000000e+000j, 4.154282228850e-004+0.000000000000e+000j, 5.922399120321e-003+0.000000000000e+000j, 1.298864957403e-002+0.000000000000e+000j, 2.847898930921e-002+0.000000000000e+000j, 6.237017449150e-002+0.000000000000e+000j, 1.358305117695e-001+0.000000000000e+000j, 2.881389883745e-001+0.000000000000e+000j, 5.458154819849e-001+0.000000000000e+000j, 7.229921484916e-001+0.000000000000e+000j, 5.458154819849e-001+0.000000000000e+000j, 2.881389883745e-001+0.000000000000e+000j, 1.358305117695e-001+0.000000000000e+000j, 6.237017449150e-002+0.000000000000e+000j, 2.847898930921e-002+0.000000000000e+000j, 1.298864957403e-002+0.000000000000e+000j, 5.922399120321e-003+0.000000000000e+000j, 2.700283448752e-003+0.000000000000e+000j];
contspec_num = [-8.769935316796e-004+-2.428329874343e-004j, -1.875362700568e-003+6.852336071705e-004j, -2.172355461653e-003+3.803973496607e-003j, 2.696100064445e-003+9.225065564141e-003j, 1.980273551578e-002+7.263397743944e-003j, 3.379036181200e-002+-3.170774178266e-002j, -4.360848889254e-002+-9.078993720824e-002j, -1.631306709404e-001+-5.610080554499e-015j, -4.360848889256e-002+9.078993720824e-002j, 3.379036181200e-002+3.170774178265e-002j, 1.980273551573e-002+-7.263397743951e-003j, 2.696100064446e-003+-9.225065564089e-003j, -2.172355461580e-003+-3.803973496603e-003j, -1.875362700487e-003+-6.852336071413e-004j, -8.769935316317e-004+2.428329874001e-004j, -2.817781191470e-004+3.042712101673e-004j, -5.700457955915e-003+-1.578414418322e-003j, -1.218985755370e-002+4.454018446608e-003j, -1.412031050075e-002+2.472582772795e-002j, 1.752465041889e-002+5.996292616692e-002j, 1.287177808526e-001+4.721208533564e-002j, 2.196373517780e-001+-2.061003215873e-001j, -2.834551778015e-001+-5.901345918536e-001j, -1.060349361112e+000+-3.441135402929e-014j, -2.834551778016e-001+5.901345918535e-001j, 2.196373517780e-001+2.061003215873e-001j, 1.287177808522e-001+-4.721208533568e-002j, 1.752465041890e-002+-5.996292616658e-002j, -1.412031050027e-002+-2.472582772792e-002j, -1.218985755316e-002+-4.454018446417e-003j, -5.700457955604e-003+1.578414418100e-003j, -1.831557774456e-003+1.977762866085e-003j];
contspec_exact = [-8.787570611436e-004+-2.408088150114e-004j, -1.875609592411e-003+6.897800621394e-004j, -2.167561273750e-003+3.809743560787e-003j, 2.707950757808e-003+9.225347158596e-003j, 1.981270952499e-002+7.248964492162e-003j, 3.377817869481e-002+-3.172732676694e-002j, -4.362974545088e-002+-9.078327397334e-002j, -1.631306710314e-001+0.000000000000e+000j, -4.362974545088e-002+9.078327397334e-002j, 3.377817869481e-002+3.172732676694e-002j, 1.981270952499e-002+-7.248964492162e-003j, 2.707950757808e-003+-9.225347158596e-003j, -2.167561273750e-003+-3.809743560787e-003j, -1.875609592411e-003+-6.897800621394e-004j, -8.787570611436e-004+2.408088150114e-004j, -2.832750817195e-004+3.038702430588e-004j, -5.711920897433e-003+-1.565257297574e-003j, -1.219146235067e-002+4.483570403906e-003j, -1.408914827938e-002+2.476333314512e-002j, 1.760167992575e-002+5.996475653088e-002j, 1.287826119124e-001+4.711826919906e-002j, 2.195581615162e-001+-2.062276239851e-001j, -2.835933454307e-001+-5.900912808267e-001j, -1.060349361704e+000+0.000000000000e+000j, -2.835933454307e-001+5.900912808267e-001j, 2.195581615162e-001+2.062276239851e-001j, 1.287826119124e-001+-4.711826919906e-002j, 1.760167992575e-002+-5.996475653088e-002j, -1.408914827938e-002+-2.476333314512e-002j, -1.219146235067e-002+-4.483570403906e-003j, -5.711920897433e-003+1.565257297574e-003j, -1.841288031177e-003+1.975156579882e-003j];


ab_abs_values = [abs(ab_num)', abs(ab_exact)'];
contspec_abs_values = [abs(contspec_num)', abs(contspec_exact)'];
ab_err = (abs(ab_num)-abs(ab_exact))';
contspec_err = (abs(contspec_num)-abs(contspec_exact))';

rel_err_a = zeros(M,1); rel_err_b1 = zeros(M,1); rel_err_b2 = zeros(M,1);
for i = 1:M
    rel_err_a(i) = (abs(ab_num(i))-abs(ab_exact(i)))/abs(ab_exact(i));
    rel_err_b1(i) = (abs(ab_num(i+M))-abs(ab_exact(i+M)))/abs(ab_exact(i+M));
    rel_err_b2(i) = (abs(ab_num(i+2*M))-abs(ab_exact(i+2*M)))/abs(ab_exact(i+2*M));
end

rel_err_contspec = zeros(2*M,1);
for i = 1:2*M
    rel_err_contspec(i) = (abs(contspec_num(i))-abs(contspec_exact(i)))/abs(contspec_exact(i));
end

% %% code to try out phase factors
% T0 = -25;
% T1 = 25;
% D = 512;
% eps_t = (T1-T0)/(D-1);
% b1_num = ab_num(M+1:2*M);
% b1_exact = ab_exact(M+1:2*M);
% 
% phase_factor = +eps_t/3;
% phase_factor = -eps_t*D - (T1+eps_t*0.5) - (T0-eps_t*0.5)% + eps_t/3
% %phase_factor = -eps_t*(D-1) + (T1+eps_t*0.5) - (T0-eps_t*0.5)     % also works pretty well for real part, slightly worse for imag part
% xi = (-sym(7):sym(8))/4;        % xi has 16 elements, M = 16
% 
% b1_C = zeros(M,1);
% for i = 1:M
%     b1_C(i) = b1_num(i)*exp(1i*xi(i)*phase_factor);
% end
% b1_side_by_side = [b1_exact', b1_C];
% real_err = abs(sum(real(b1_C))+sum(real(b1_exact)))
% imag_err = abs(sum(imag(b1_C))-sum(imag(b1_exact)))
% 
% %% code to try out phase factors
% M = 16;
% T0 = -25;
% T1 = 25;
% D = 512;
% eps_t = (T1-T0)/(D-1);
% a_num = ab_num(1:M);
% a_exact = ab_exact(1:M);
% 
% phase_factor = (T1+eps_t*0.5) - (T0-eps_t*0.5);
% phase_factor = eps_t;
% xi = (-sym(7):sym(8))/4;        % xi has 16 elements, M = 16
% 
% a_C = zeros(M,1);
% for i = 1:M
%     a_C(i) = a_num(i)*exp(1i*xi(i)*phase_factor);
% end
% a_side_by_side = [a_exact', a_C];
% real_err = norm(abs(real(a_C))-abs(real(a_exact)))
% imag_err = norm(abs(imag(a_C))-abs(imag(a_exact)))
