% For D = 512
M = 16;

ab_num = [-1.008307632120e+000+-2.320287961728e-002j, -8.295547117234e-001+-5.695009694967e-001j, -3.057248128210e-001+-9.562868366336e-001j, 4.370461898592e-001+-9.003387247095e-001j, 9.668836201898e-001+-2.221652116393e-001j, 6.407625119231e-001+7.111497469521e-001j, -3.921964106171e-001+7.358488561872e-001j, -6.818433384500e-001+1.564330887049e-014j, -3.921964106171e-001+-7.358488561872e-001j, 6.407625119230e-001+-7.111497469521e-001j, 9.668836201898e-001+2.221652116393e-001j, 4.370461898593e-001+9.003387247096e-001j, -3.057248128210e-001+9.562868366337e-001j, -8.295547117234e-001+5.695009694967e-001j, -1.008307632120e+000+2.320287961724e-002j, -8.927919114053e-001+-4.748520531005e-001j, -9.177948033499e-004+-2.100996567666e-007j, -2.009062341015e-003+-3.046588166341e-007j, -4.397947186181e-003+-4.168588095197e-007j, -9.618750226376e-003+-5.297117427786e-007j, -2.092570812659e-002+-6.100967370748e-007j, -4.435621749398e-002+-6.049399359212e-007j, -8.398448849231e-002+-4.263628886878e-007j, -1.112295612776e-001+4.906723916065e-015j, -8.398448849231e-002+4.263628931907e-007j, -4.435621749398e-002+6.049399388724e-007j, -2.092570812664e-002+6.100966978150e-007j, -9.618750226423e-003+5.297117527199e-007j, -4.397947186241e-003+4.168588544417e-007j, -2.009062341083e-003+3.046587961048e-007j, -9.177948034107e-004+2.100996557061e-007j, -4.193567052092e-004+1.383052935758e-007j, -5.965666221774e-003+-1.365647768434e-006j, -1.305890521660e-002+-1.980282307141e-006j, -2.858665671018e-002+-2.709582258553e-006j, -6.252187647144e-002+-3.443126326825e-006j, -1.360171028229e-001+-3.965628791597e-006j, -2.883154137108e-001+-3.932109585752e-006j, -5.458991752000e-001+-2.771358775824e-006j, -7.229921483041e-001+3.123204805888e-014j, -5.458991752000e-001+2.771358804114e-006j, -2.883154137109e-001+3.932109603293e-006j, -1.360171028232e-001+3.965628536710e-006j, -6.252187647175e-002+3.443126391067e-006j, -2.858665671057e-002+2.709582552135e-006j, -1.305890521704e-002+1.980282175736e-006j, -5.965666222167e-003+1.365647763203e-006j, -2.725818583859e-003+8.989844092230e-007j];
ab_exact = [-9.644260197536e-001+-2.642849739162e-001j, -9.384622196167e-001+3.451318071639e-001j, -4.943100550496e-001+8.688079880664e-001j, 2.810892903972e-001+9.576046680321e-001j, 9.302059085550e-001+3.403385888745e-001j, 6.972263717197e-001+-6.548940701021e-001j, -3.611240215511e-001+-7.514144455356e-001j, -6.818433382465e-001+0.000000000000e+000j, -3.611240215511e-001+7.514144455356e-001j, 6.972263717197e-001+6.548940701021e-001j, 9.302059085550e-001+-3.403385888745e-001j, 2.810892903972e-001+-9.576046680321e-001j, -4.943100550496e-001+-8.688079880664e-001j, -9.384622196167e-001+-3.451318071639e-001j, -9.644260197536e-001+2.642849739162e-001j, -6.818818551989e-001+7.314572246134e-001j, 9.111383262032e-004+0.000000000000e+000j, 1.998253780620e-003+0.000000000000e+000j, 4.381382970647e-003+0.000000000000e+000j, 9.595411460231e-003+0.000000000000e+000j, 2.089700181070e-002+0.000000000000e+000j, 4.432907513454e-002+0.000000000000e+000j, 8.397161261306e-002+0.000000000000e+000j, 1.112295613064e-001+0.000000000000e+000j, 8.397161261306e-002+0.000000000000e+000j, 4.432907513454e-002+0.000000000000e+000j, 2.089700181070e-002+0.000000000000e+000j, 9.595411460231e-003+0.000000000000e+000j, 4.381382970647e-003+0.000000000000e+000j, 1.998253780620e-003+0.000000000000e+000j, 9.111383262032e-004+0.000000000000e+000j, 4.154282228850e-004+0.000000000000e+000j, 5.922399120321e-003+0.000000000000e+000j, 1.298864957403e-002+0.000000000000e+000j, 2.847898930921e-002+0.000000000000e+000j, 6.237017449150e-002+0.000000000000e+000j, 1.358305117695e-001+0.000000000000e+000j, 2.881389883745e-001+0.000000000000e+000j, 5.458154819849e-001+0.000000000000e+000j, 7.229921484916e-001+0.000000000000e+000j, 5.458154819849e-001+0.000000000000e+000j, 2.881389883745e-001+0.000000000000e+000j, 1.358305117695e-001+0.000000000000e+000j, 6.237017449150e-002+0.000000000000e+000j, 2.847898930921e-002+0.000000000000e+000j, 1.298864957403e-002+0.000000000000e+000j, 5.922399120321e-003+0.000000000000e+000j, 2.700283448752e-003+0.000000000000e+000j];
contspec_num = [8.768822621361e-004+2.432344809935e-004j, 1.875570435020e-003+-6.846648070598e-004j, 2.173076540743e-003+-3.803561615367e-003j, -2.695083985617e-003+-9.225362460643e-003j, -1.980231194799e-002+-7.264552443687e-003j, -3.379122667387e-002+3.170682008995e-002j, 4.360756706625e-002+9.079037997679e-002j, 1.631306709404e-001+-3.453609225907e-015j, 4.360756706626e-002+-9.079037997680e-002j, -3.379122667387e-002+-3.170682008995e-002j, -1.980231194805e-002+7.264552443665e-003j, -2.695083985621e-003+9.225362460690e-003j, 2.173076540811e-003+3.803561615397e-003j, 1.875570435077e-003+6.846648071022e-004j, 8.768822621945e-004+-2.432344810086e-004j, 2.815773584904e-004+-3.044570067759e-004j, 5.699734703884e-003+1.581024126457e-003j, 1.219120782763e-002+-4.450321245889e-003j, 1.412499751483e-002+-2.472315049989e-002j, -1.751804590651e-002+-5.996485599418e-002j, -1.287150276619e-001+-4.721959088397e-002j, -2.196429733801e-001+2.060943305847e-001j, 2.834491859307e-001+5.901374698492e-001j, 1.060349361112e+000+-2.147806492568e-014j, 2.834491859307e-001+-5.901374698492e-001j, -2.196429733802e-001+-2.060943305847e-001j, -1.287150276623e-001+4.721959088382e-002j, -1.751804590654e-002+5.996485599449e-002j, 1.412499751527e-002+2.472315050008e-002j, 1.219120782800e-002+4.450321246162e-003j, 5.699734704262e-003+-1.581024126557e-003j, 1.830252830186e-003+-1.978970544043e-003j];
contspec_exact = [-8.787570611436e-004+-2.408088150114e-004j, -1.875609592411e-003+6.897800621394e-004j, -2.167561273750e-003+3.809743560787e-003j, 2.707950757808e-003+9.225347158596e-003j, 1.981270952499e-002+7.248964492162e-003j, 3.377817869481e-002+-3.172732676694e-002j, -4.362974545088e-002+-9.078327397334e-002j, -1.631306710314e-001+0.000000000000e+000j, -4.362974545088e-002+9.078327397334e-002j, 3.377817869481e-002+3.172732676694e-002j, 1.981270952499e-002+-7.248964492162e-003j, 2.707950757808e-003+-9.225347158596e-003j, -2.167561273750e-003+-3.809743560787e-003j, -1.875609592411e-003+-6.897800621394e-004j, -8.787570611436e-004+2.408088150114e-004j, -2.832750817195e-004+3.038702430588e-004j, -5.711920897433e-003+-1.565257297574e-003j, -1.219146235067e-002+4.483570403906e-003j, -1.408914827938e-002+2.476333314512e-002j, 1.760167992575e-002+5.996475653088e-002j, 1.287826119124e-001+4.711826919906e-002j, 2.195581615162e-001+-2.062276239851e-001j, -2.835933454307e-001+-5.900912808267e-001j, -1.060349361704e+000+0.000000000000e+000j, -2.835933454307e-001+5.900912808267e-001j, 2.195581615162e-001+2.062276239851e-001j, 1.287826119124e-001+-4.711826919906e-002j, 1.760167992575e-002+-5.996475653088e-002j, -1.408914827938e-002+-2.476333314512e-002j, -1.219146235067e-002+-4.483570403906e-003j, -5.711920897433e-003+1.565257297574e-003j, -1.841288031177e-003+1.975156579882e-003j];

ab_abs_values = [abs(ab_num)', abs(ab_exact)'];
contspec_abs_values = [abs(contspec_num)', abs(contspec_exact)'];
ab_err = (abs(ab_num)-abs(ab_exact))';
contspec_err = (abs(contspec_num)-abs(contspec_exact))';

rel_err_a = zeros(M,1); rel_err_b1 = zeros(M,1); rel_err_b2 = zeros(M,1);
for i = 1:M
    rel_err_a(i) = (abs(ab_num(i))-abs(ab_exact(i)))/abs(ab_exact(i));
    rel_err_b1(i) = (abs(ab_num(i+M))-abs(ab_exact(i+M)))/abs(ab_exact(i+M));
    rel_err_b2(i) = (abs(ab_num(i+2*M))-abs(ab_exact(i+2*M)))/abs(ab_exact(i+2*M));
end

rel_err_contspec = zeros(2*M,1);
for i = 1:2*M
    rel_err_contspec(i) = (abs(contspec_num(i))-abs(contspec_exact(i)))/abs(contspec_exact(i));
end

% %% code to try out phase factors
% T0 = -25;
% T1 = 25;
% D = 512;
% eps_t = (T1-T0)/(D-1);
% b1_num = ab_num(M+1:2*M);
% b1_exact = ab_exact(M+1:2*M);
% 
% phase_factor = +eps_t/3;
% phase_factor = -eps_t*D - (T1+eps_t*0.5) - (T0-eps_t*0.5)% + eps_t/3
% %phase_factor = -eps_t*(D-1) + (T1+eps_t*0.5) - (T0-eps_t*0.5)     % also works pretty well for real part, slightly worse for imag part
% xi = (-sym(7):sym(8))/4;        % xi has 16 elements, M = 16
% 
% b1_C = zeros(M,1);
% for i = 1:M
%     b1_C(i) = b1_num(i)*exp(1i*xi(i)*phase_factor);
% end
% b1_side_by_side = [b1_exact', b1_C];
% real_err = abs(sum(real(b1_C))+sum(real(b1_exact)))
% imag_err = abs(sum(imag(b1_C))-sum(imag(b1_exact)))
% 
% %% code to try out phase factors
% M = 16;
% T0 = -25;
% T1 = 25;
% D = 512;
% eps_t = (T1-T0)/(D-1);
% a_num = ab_num(1:M);
% a_exact = ab_exact(1:M);
% 
% phase_factor = (T1+eps_t*0.5) - (T0-eps_t*0.5);
% phase_factor = eps_t;
% xi = (-sym(7):sym(8))/4;        % xi has 16 elements, M = 16
% 
% a_C = zeros(M,1);
% for i = 1:M
%     a_C(i) = a_num(i)*exp(1i*xi(i)*phase_factor);
% end
% a_side_by_side = [a_exact', a_C];
% real_err = norm(abs(real(a_C))-abs(real(a_exact)))
% imag_err = norm(abs(imag(a_C))-abs(imag(a_exact)))
