% For D = 512
M = 16;

ab_num = [-9.644549231497e-001+2.642270306084e-001j, -9.384546401355e-001+-3.451788609784e-001j, -4.942848534549e-001+-8.688295299853e-001j, 2.811104094632e-001+-9.576025448641e-001j, 9.302118102640e-001+-3.403283003964e-001j, 6.972232959887e-001+6.548981011063e-001j, -3.611248632848e-001+7.514137791890e-001j, -6.818433384500e-001+7.256746643920e-015j, -3.611248632848e-001+-7.514137791891e-001j, 6.972232959887e-001+-6.548981011063e-001j, 9.302118102641e-001+3.403283003965e-001j, 2.811104094632e-001+9.576025448642e-001j, -4.942848534551e-001+8.688295299854e-001j, -9.384546401358e-001+3.451788609783e-001j, -9.644549231499e-001+-2.642270306085e-001j, -6.819537336204e-001+-7.314129189384e-001j, 8.978757806348e-004+-1.552663343565e-004j, 1.976871159435e-003+-2.922489669506e-004j, 4.348808298398e-003+-5.345675424599e-004j, 9.549734916215e-003+-9.374098616543e-004j, 2.084102904000e-002+-1.532181198192e-003j, 4.427629146854e-002+-2.167888984336e-003j, 8.394661237856e-002+-2.053898250658e-003j, 1.112295612775e-001+1.970078421386e-013j, 8.394661237853e-002+2.053898250753e-003j, 4.427629146861e-002+2.167888984263e-003j, 2.084102903994e-002+1.532181198259e-003j, 9.549734916092e-003+9.374098617282e-004j, 4.348808298390e-003+5.345675424853e-004j, 1.976871159466e-003+2.922489670170e-004j, 8.978757806438e-004+1.552663344251e-004j, 4.075356099020e-004+8.078648788212e-005j, 5.836192574127e-003+-1.009231173318e-003j, 1.284966253633e-002+-1.899618285181e-003j, 2.826725393959e-002+-3.474689025988e-003j, 6.207327695540e-002+-6.093164100755e-003j, 1.354666887600e-001+-9.959177788247e-003j, 2.877958945455e-001+-1.409127839819e-002j, 5.456529804607e-001+-1.335033862927e-002j, 7.229921483041e-001+1.281608564130e-012j, 5.456529804605e-001+1.335033862989e-002j, 2.877958945460e-001+1.409127839772e-002j, 1.354666887596e-001+9.959177788684e-003j, 6.207327695460e-002+6.093164101233e-003j, 2.826725393954e-002+3.474689026150e-003j, 1.284966253653e-002+1.899618285609e-003j, 5.836192574187e-003+1.009231173764e-003j, 2.648981464369e-003+5.251121712321e-004j];
ab_exact = [-9.644260197536e-001+2.642849739162e-001j, -9.384622196167e-001+-3.451318071639e-001j, -4.943100550496e-001+-8.688079880664e-001j, 2.810892903972e-001+-9.576046680321e-001j, 9.302059085550e-001+-3.403385888745e-001j, 6.972263717197e-001+6.548940701021e-001j, -3.611240215511e-001+7.514144455356e-001j, -6.818433382465e-001+0.000000000000e+000j, -3.611240215511e-001+-7.514144455356e-001j, 6.972263717197e-001+-6.548940701021e-001j, 9.302059085550e-001+3.403385888745e-001j, 2.810892903972e-001+9.576046680321e-001j, -4.943100550496e-001+8.688079880664e-001j, -9.384622196167e-001+3.451318071639e-001j, -9.644260197536e-001+-2.642849739162e-001j, -6.818818551989e-001+-7.314572246134e-001j, 9.111383262032e-004+0.000000000000e+000j, 1.998253780620e-003+0.000000000000e+000j, 4.381382970647e-003+0.000000000000e+000j, 9.595411460231e-003+0.000000000000e+000j, 2.089700181070e-002+0.000000000000e+000j, 4.432907513454e-002+0.000000000000e+000j, 8.397161261306e-002+0.000000000000e+000j, 1.112295613064e-001+0.000000000000e+000j, 8.397161261306e-002+0.000000000000e+000j, 4.432907513454e-002+0.000000000000e+000j, 2.089700181070e-002+0.000000000000e+000j, 9.595411460231e-003+0.000000000000e+000j, 4.381382970647e-003+0.000000000000e+000j, 1.998253780620e-003+0.000000000000e+000j, 9.111383262032e-004+0.000000000000e+000j, 4.154282228850e-004+0.000000000000e+000j, 5.922399120321e-003+0.000000000000e+000j, 1.298864957403e-002+0.000000000000e+000j, 2.847898930921e-002+0.000000000000e+000j, 6.237017449150e-002+0.000000000000e+000j, 1.358305117695e-001+0.000000000000e+000j, 2.881389883745e-001+0.000000000000e+000j, 5.458154819849e-001+0.000000000000e+000j, 7.229921484916e-001+0.000000000000e+000j, 5.458154819849e-001+0.000000000000e+000j, 2.881389883745e-001+0.000000000000e+000j, 1.358305117695e-001+0.000000000000e+000j, 6.237017449150e-002+0.000000000000e+000j, 2.847898930921e-002+0.000000000000e+000j, 1.298864957403e-002+0.000000000000e+000j, 5.922399120321e-003+0.000000000000e+000j, 2.700283448752e-003+0.000000000000e+000j];
contspec_num = [-9.069960546480e-004+-8.749661379830e-005j, -1.754596731016e-003+9.567843022326e-004j, -1.686481094482e-003+4.045910177359e-003j, 3.596489503424e-003+8.916772751987e-003j, 2.029116668863e-002+5.776616696025e-003j, 3.218615756664e-002+-3.334160317129e-002j, -4.583738918380e-002+-8.968905460978e-002j, -1.631306709403e-001+-2.906703474408e-013j, -4.583738918389e-002+8.968905460970e-002j, 3.218615756675e-002+3.334160317129e-002j, 2.029116668860e-002+-5.776616695940e-003j, 3.596489503459e-003+-8.916772751846e-003j, -1.686481094456e-003+-4.045910177364e-003j, -1.754596731022e-003+-9.567843023054e-004j, -9.069960546746e-004+8.749661373451e-005j, -3.370000329779e-004+2.429779056138e-004j, -5.895474355213e-003+-5.687279896878e-004j, -1.140487875160e-002+6.219097964513e-003j, -1.096212711413e-002+2.629841615283e-002j, 2.337718177226e-002+5.795902288792e-002j, 1.318925834761e-001+3.754800852416e-002j, 2.092100241831e-001+-2.167204206134e-001j, -2.979430296947e-001+-5.829788549636e-001j, -1.060349361112e+000+-1.890908333473e-012j, -2.979430296953e-001+5.829788549631e-001j, 2.092100241838e-001+2.167204206134e-001j, 1.318925834759e-001+-3.754800852361e-002j, 2.337718177249e-002+-5.795902288700e-002j, -1.096212711397e-002+-2.629841615286e-002j, -1.140487875165e-002+-6.219097964984e-003j, -5.895474355387e-003+5.687279892744e-004j, -2.190500214359e-003+1.579356386495e-003j];
contspec_exact = [-8.787570611436e-004+-2.408088150114e-004j, -1.875609592411e-003+6.897800621394e-004j, -2.167561273750e-003+3.809743560787e-003j, 2.707950757808e-003+9.225347158596e-003j, 1.981270952499e-002+7.248964492162e-003j, 3.377817869481e-002+-3.172732676694e-002j, -4.362974545088e-002+-9.078327397334e-002j, -1.631306710314e-001+0.000000000000e+000j, -4.362974545088e-002+9.078327397334e-002j, 3.377817869481e-002+3.172732676694e-002j, 1.981270952499e-002+-7.248964492162e-003j, 2.707950757808e-003+-9.225347158596e-003j, -2.167561273750e-003+-3.809743560787e-003j, -1.875609592411e-003+-6.897800621394e-004j, -8.787570611436e-004+2.408088150114e-004j, -2.832750817195e-004+3.038702430588e-004j, -5.711920897433e-003+-1.565257297574e-003j, -1.219146235067e-002+4.483570403906e-003j, -1.408914827938e-002+2.476333314512e-002j, 1.760167992575e-002+5.996475653088e-002j, 1.287826119124e-001+4.711826919906e-002j, 2.195581615162e-001+-2.062276239851e-001j, -2.835933454307e-001+-5.900912808267e-001j, -1.060349361704e+000+0.000000000000e+000j, -2.835933454307e-001+5.900912808267e-001j, 2.195581615162e-001+2.062276239851e-001j, 1.287826119124e-001+-4.711826919906e-002j, 1.760167992575e-002+-5.996475653088e-002j, -1.408914827938e-002+-2.476333314512e-002j, -1.219146235067e-002+-4.483570403906e-003j, -5.711920897433e-003+1.565257297574e-003j, -1.841288031177e-003+1.975156579882e-003j];

ab_abs_values = [abs(ab_num)', abs(ab_exact)'];
contspec_abs_values = [abs(contspec_num)', abs(contspec_exact)'];
ab_err = (abs(ab_num)-abs(ab_exact))';
contspec_err = (abs(contspec_num)-abs(contspec_exact))';

rel_err_a = zeros(M,1); rel_err_b1 = zeros(M,1); rel_err_b2 = zeros(M,1);
for i = 1:M
    rel_err_a(i) = (abs(ab_num(i))-abs(ab_exact(i)))/abs(ab_exact(i));
    rel_err_b1(i) = (abs(ab_num(i+M))-abs(ab_exact(i+M)))/abs(ab_exact(i+M));
    rel_err_b2(i) = (abs(ab_num(i+2*M))-abs(ab_exact(i+2*M)))/abs(ab_exact(i+2*M));
end

rel_err_contspec = zeros(2*M,1);
for i = 1:2*M
    rel_err_contspec(i) = (abs(contspec_num(i))-abs(contspec_exact(i)))/abs(contspec_exact(i));
end

% %% code to try out phase factors
% T0 = -25;
% T1 = 25;
% D = 512;
% eps_t = (T1-T0)/(D-1);
% b1_num = ab_num(M+1:2*M);
% b1_exact = ab_exact(M+1:2*M);
% 
% phase_factor = +eps_t/3;
% phase_factor = -eps_t*D - (T1+eps_t*0.5) - (T0-eps_t*0.5)% + eps_t/3
% %phase_factor = -eps_t*(D-1) + (T1+eps_t*0.5) - (T0-eps_t*0.5)     % also works pretty well for real part, slightly worse for imag part
% xi = (-sym(7):sym(8))/4;        % xi has 16 elements, M = 16
% 
% b1_C = zeros(M,1);
% for i = 1:M
%     b1_C(i) = b1_num(i)*exp(1i*xi(i)*phase_factor);
% end
% b1_side_by_side = [b1_exact', b1_C];
% real_err = abs(sum(real(b1_C))+sum(real(b1_exact)))
% imag_err = abs(sum(imag(b1_C))-sum(imag(b1_exact)))
% 
% %% code to try out phase factors
% M = 16;
% T0 = -25;
% T1 = 25;
% D = 512;
% eps_t = (T1-T0)/(D-1);
% a_num = ab_num(1:M);
% a_exact = ab_exact(1:M);
% 
% phase_factor = (T1+eps_t*0.5) - (T0-eps_t*0.5);
% phase_factor = eps_t;
% xi = (-sym(7):sym(8))/4;        % xi has 16 elements, M = 16
% 
% a_C = zeros(M,1);
% for i = 1:M
%     a_C(i) = a_num(i)*exp(1i*xi(i)*phase_factor);
% end
% a_side_by_side = [a_exact', a_C];
% real_err = norm(abs(real(a_C))-abs(real(a_exact)))
% imag_err = norm(abs(imag(a_C))-abs(imag(a_exact)))
